<h2>Step-1</h2>
<div class="answer"> <p> <b>Function to fix deadlock:</b> </p> <p>The deadlock condition can be prevented by adding a new lock named as lock3. This is acquired before the two locks are acquired. </p> <p>The transaction function to prevent the deadlock condition is as given below:</p> </div>
<h2>Step-2</h2>
<div class="answer"> <p>void transaction(Account from, Account to, double amount)</p> <p>{</p> <p>Semaphore lock1, lock2, lock3;</p> <p>//acquire the lock3</p> <p>Wait(lock3);</p> <p>// request to get the lock for lock1</p> <p>lock1 = getLock(from);</p> <p>// request to get the lock for lock2</p> <p>lock2 = getLock(to);</p> <p>// acquire the lock to perform the transaction</p> <p>wait(lock1);</p> <p>// acquire the lock to perform the transaction</p> <p>wait(lock2);</p> <p>// The first lock is used to withdraw the balance from any account and the second lock is used to deposit the balance in an account. </p> <p>// withdraw the balance from the account</p> <p>withdraw(from, amount);</p> <p>// deposit the balance to the account</p> <p>deposit(to, amount);</p> <p>//After performing the transactions, both the locks is released by using signal parameter to prevent the deadlock condition. </p> <p>// first release the lock 3 </p> <p> </p> <p>signal(lock3);</p> <p>// release the lock2 and lock1 after performing transaction</p> <p>signal (lock2);</p> <p>signal(lock1);</p> <p> }</p></div>
