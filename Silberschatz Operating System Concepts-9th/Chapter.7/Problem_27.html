<h2>Step-1</h2>
<div class="answer"> <p> <b>Program Plan:</b> </p> <p>• Define user define datatype which takes two possible directions that are possible on the bridge.</p> <p>• Define the method init_synch which takes two value as an argument which initialize the synchronization variables that is a mutex and a condition variable. </p> <p>• Define the method destroy_synch which takes two value as an argument which destroy the synchronization variables that is a mutex and a condition variable. </p> <p>• Define the method create_threads to simulate the farmers. Create num_north threads for the farmers from North Tunbridge and create num_south threads for the farmers from South Tunbridge. </p> <p>• Define the method destroy_threads which is use for destroying the threads created. </p> <p>• Define the method north_runner which takes one value as an arguments and the thread runner function for a farmer from North Tunbridge.</p> <p>• Define the method south_runner which takes one value as an arguments and the thread runner function for a farmer from South Tunbridge.</p> <p>• Define the method north_enter to enter the bridge from the north side. </p> <p>• Define the method north_exit which exit the bridge after entering it from the north. </p> <p>• Define the function south_enter which enter the bridge from the south side. </p> <p>• Define the function south_exit which exit the bridge after entering it from the south. </p> <p>• Define the main method from where the execution of the program begins.</p> </div>
<h2>Step-2</h2>
<div class="answer"> <p> <b>Program:</b> </p> <p>/*********************************************************** Program for designing an echo server in which * * echo server provides services to each client in a * * separate request. * **********************************************************/</p> <p>Include a header file for performing the operation. </p> <p>#include <stdio.h></p> <p>#include <pthread.h></p> <p>#include <stdlib.h></p> <p>#include <time.h></p> <p>#include <semaphore.h></p> <p>#include <unistd.h></p> <p>// The number of farmers going north</p> <p>const int NUM_NORTH <b>=</b> 20<b>;</b></p> <p>// The number of farmers going south</p> <p>const int NUM_SOUTH <b>=</b> 20<b>;</b></p> <p>// The maximum amount of time taken to cross the bridge</p> <p>const int MAX_CROSSING_TIME <b>=</b> 5<b>;</b></p> <p>// Mutex used to prevent a deadlock</p> <p>static pthread_mutex_t s_mutex<b>;</b></p> <p>// Condition variable used to notify</p> <p>// that the bridge is free</p> <p>static pthread_cond_t s_cond<b>;</b></p> <p>// The number of farmers crossing north on the bridge</p> <p>static int s_num_north<b>;</b></p> <p>// The number of farmers crossing south on the bridge</p> <p>static int s_num_south<b>;</b></p> <p>// The number of farmers waiting to cross </p> <p>// the bridge from the north direction</p> <p>static int s_num_north_waiting<b>;</b></p> <p>// The number of farmers waiting to cross </p> <p>// the bridge from the south direction</p> <p>static int s_num_south_waiting<b>;</b></p> <p>Define user define datatype which takes two possible directions that are possible on the bridge.</p> <p>enum Direction </p> <p> <b>{</b> </p> <p> NORTH<b>,</b></p> <p> SOUTH<b>,</b></p> <p> <b>};</b> </p> <p>// The current direction on the bridge</p> <p>static enum Direction s_direction<b>;</b></p> <p>Declare the method init_synch which takes two values as an arguments and it is use for initializing the synchronization variables. </p> <p>static int init_synch<b>(</b>pthread_mutex_t <b>*</b>pmutex<b>,</b></p> <p> pthread_cond_t <b>*</b>pcond<b>);</b></p> <p>Declare the method destroy_synch which takes two values as an arguments and it is use for destroying the synchronization variables. </p> <p>static void destroy_synch<b>(</b>pthread_mutex_t <b>*</b>pmutex<b>,</b></p> <p> </div>
<h2>Step-3</h2>
<div class="answer"> pthread_cond_t <b>*</b>pcond<b>);</b></p> <p>Declare the method create_threads which is use for creating the threads. </p> <p>static int create_threads<b>(</b>pthread_attr_t <b>*</b>attr<b>,</b></p> <p> pthread_t <b>*</b>north_ids<b>,</b></p> <p> pthread_t <b>*</b>south_ids<b>,</b></p> <p> int <b>*</b>north_nums<b>,</b></p> <p> int <b>*</b>south_nums<b>,</b></p> <p> const int num_north<b>,</b></p> <p> const int num_south<b>);</b></p> <p>Declare the method destroy_threads which is use for destroying the threads.</p> <p> </p> <p>static void destroy_threads<b>(</b>pthread_t <b>*</b>north_ids<b>,</b></p> <p> pthread_t <b>*</b>south_ids<b>,</b></p> <p> int <b>*</b>north_nums<b>,</b></p> <p> int <b>*</b>south_nums<b>,</b></p> <p> const int num_north<b>,</b></p> <p> const int num_south<b>);</b></p> <p>Declare the method north_runner which takes one value as an argument. This function tracks the farmer going north. </p> <p>static void <b>*</b>north_runner<b>(</b>void <b>*</b>param<b>);</b></p> <p>Declare the method south_runner which takes one values as an argument. This function tracks the farmer going south. </p> <p>static void <b>*</b>south_runner<b>(</b>void <b>*</b>param<b>);</b></p> <p>Declare the method north_enter which takes one values as an argument. Farmer enter the bridge from the north direction.</p> <p>static void north_enter<b>(</b>void<b>);</b></p> <p>Declare the method north_exit which takes one values as an argument. Farmer exits the bridge after entering it from the north direction.</p> <p>static void north_exit<b>(</b>void<b>);</b></p> <p>Declare the method south_enter which takes one values as an argument. Farmer enter the bridge from the south direction.</p> <p>static void south_enter<b>(</b>void<b>);</b></p> <p>Declare the method south_exit which takes one values as an argument. Farmer exits the bridge after entering it from the south direction.</p> <p>static void south_exit<b>(</b>void<b>);</b></p> <p>Define the main method from where the execution of the program begins.</p> <p>int main<b>(</b>void<b>)</b></p> <p> <b>{</b> </p> <p> // The pthread attributes</p> <p> pthread_attr_t attr<b>;</b></p> <p> // An array for storing the thread ids</p> <p> pthread_t north_ids<b>[</b>NUM_NORTH<b>];</b></p> <p> pthread_t south_ids<b>[</b>NUM_SOUTH<b>];</b></p> <p> // An array for storing the thread numbers</p> <p> int north_nums<b>[</b>NUM_NORTH<b>];</b></p> <p> int south_nums<b>[</b>NUM_SOUTH<b>];</b></p> <p> // Initialize the synchronization variables</p> <p> <b>if</b> <b>(</b>init_synch<b>(&</b>s_mutex<b>,</b> <b>&</b>s_cond<b>)</b> <b><</b> 0<b>)</b></p> <p> <b>return</b> 1<b>;</b></p> <p> // Initialize pthreads</p> <p> <b>if</b> <b>(</b>pthread_attr_init<b>(&</b>attr<b>)</b> <b>!=</b> 0<b>)</b> </p> <p> <b>{</b></p> <p> fputs<b>(</b>"pthread_attr_init didn't work\n"<b>,</b></p> <p> stderr<b>);</b></p> <p> // Destroy the synchronization variables</p> <p> destroy_synch<b>(&</b>s_mutex<b>,</b> <b>&</b>s_cond<b>);</b></p> <p> <b>return</b> 2<b>;</b></p> <p> <b>}</b></p> <p> // Seed the random number generator</p> <p> // with the current time</p> <p> srand<b>(</b>time<b>(</b><b>NULL</b><b>));</b></p> <p> // No farmers are on the bridge</p> <p> s_num_north <b>=</b> s_num_south <b>=</b> 0<b>;</b></p> <p> // No farmers are either waiting to cross the bridge</p> <p> s_num_north_waiting <b>=</b> s_num_south_waiting <b>=</b> 0<b>;</b></p> <p> // Set the initial direction to north</p> <p> s_direction <b>=</b> NORTH<b>;</b></p> <p> // Create the threads/farmers</p> <p> <b>if</b> <b>(</b>create_threads<b>(&</b>attr<b>,</b></p> <p> north_ids<b>,</b> south_ids<b>,</b></p> <p> north_nums<b>,</b> south_nums<b>,</b></p> <p> NUM_NORTH<b>,</b> NUM_SOUTH<b>)</b> <b><</b> 0<b>)</b> </p> <p> <b>{</b></p> <p> fputs<b>(</b>"Couldn't create threads\n"<b>,</b> stderr<b>);</b></p> <p> // De-initialize pthreads</p> <p> pthread_attr_destroy<b>(&</b>attr<b>);</b></p> <p> // Destroy the synchronization variables</p> <p> destroy_synch<b>(&</b>s_mutex<b>,</b> <b>&</b>s_cond<b>);</b></p> <p> <b>return</b> 3<b>;</b></p> <p> <b>}</b></p> <p>Call the methods destroy_threads for the threads/farmers to exit. </p> <p> destroy_threads<b>(</b>north_ids<b>,</b> south_ids<b>,</b></p> <p> north_nums<b>,</b> south_nums<b>,</b></p> <p> NUM_NORTH<b>,</b> NUM_SOUTH<b>);</b></p> <p> // De-initialize pthreads</p> <p> pthread_attr_destroy<b>(&</b>attr<b>);</b></p> <p> // Destroy the synchronization variables</p> <p> destroy_synch<b>(&</b>s_mutex<b>,</b> <b>&</b>s_cond<b>);</b></p> <p> <b>return</b> 0<b>;</b></p> <p> <b>}</b> </p> <p>Define the method init_synch which takes two value as an argument which initialize the synchronization variables that is a mutex and a condition variable. </p> <p>int init_synch<b>(</b>pthread_mutex_t <b>*</b>pmutex<b>,</b></p> <p> pthread_cond_t <b>*</b>pcond<b>)</b></p> <p> <b>{</b> </p> <p> <b>if</b> <b>(!</b>pmutex <b>||</b> <b>!</b>pcond<b>)</b></p> <p> <b>return</b> <b>-</b>1<b>;</b></p> <p> // Initialize the mutex</p> <p> <b>if</b> <b>(</b>pthread_mutex_init<b>(</b>pmutex<b>,</b> <b>NULL</b><b>)</b> <b>!=</b> 0<b>)</b> <b>{</b></p> <p> fputs<b>(</b>"pthread_mutex_init didn't work\n"<b>,</b></p> <p> stderr<b>);</b></p> <p> <b>return</b> <b>-</b>2<b>;</b></p> <p> <b>}</b></p> <p> // Initialize the condition variable</p> <p> <b>if</b> <b>(</b>pthread_cond_init<b>(</b>pcond<b>,</b> <b>NULL</b><b>)</b> <b>!=</b> 0<b>)</b> <b>{</b></p> <p> fputs<b>(</b>"pthread_cond_init blew\n"<b>,</b> stderr<b>);</b></p> <p> // Destroy the mutex</p> <p> pthread_mutex_destroy<b>(&</b>s_mutex<b>);</b></p> <p> <b>return</b> <b>-</b>3<b>;</b></p> <p> <b>}</b></p> <p> <b>return</b> 0<b>;</b></p> <p> <b>}</b> </p> <p>Define the method destroy_synch which takes two value as an argument which destroy the synchronization variables that is a mutex and a condition variable. </p> <p>void destroy_synch<b>(</b>pthread_mutex_t <b>*</b>pmutex<b>,</b></p> <p> pthread_cond_t <b>*</b>pcond<b>)</b></p> <p> <b>{</b> </p> <p> <b>if</b> <b>(</b>pcond<b>)</b></p> <p> // Destroy the condition variable</p> <p> pthread_cond_destroy<b>(</b>pcond<b>);</b></p> <p> <b>if</b> <b>(</b>pmutex<b>)</b></p> <p> // Destroy the mutex</p> <p> pthread_mutex_destroy<b>(</b>pmutex<b>);</b></p> <p> <b>}</b> </p> <p>Define the method create_threads to simulate the farmers. Create num_north threads for the farmers from North Tunbridge and create num_south threads for the farmers from South Tunbridge. </p> <p>int create_threads<b>(</b>pthread_attr_t <b>*</b>attr<b>,</b></p> <p> pthread_t <b>*</b>north_ids<b>,</b></p> <p> pthread_t <b>*</b>south_ids<b>,</b></p> <p> int <b>*</b>north_nums<b>,</b></p> <p> int <b>*</b>south_nums<b>,</b></p> <p> const int num_north<b>,</b></p> <p> const int num_south<b>)</b></p> <p> <b>{</b> </p> <p> // Used to index into the thread_ids array</p> <p> int index<b>;</b></p> <p> // The value returned by functions</p> <p> int ret<b>;</b></p> <p> <b>if</b> <b>(!</b>attr <b>||</b> <b>!</b>north_ids <b>||</b> <b>!</b>south_ids </p> <p> <b>||</b> <b>!</b>north_nums <b>||</b> <b>!</b>south_nums</p> <p> <b>||</b> num_north <b><</b> 0 <b>||</b> num_south <b><</b> 0<b>)</b></p> <p> <b>return</b> <b>-</b>1<b>;</b></p> <p> // Loop to create the threads</p> <p> <b>for</b> <b>(</b>index <b>=</b> 0<b>;</b> index <b><</b> num_north</p> <p> <b>||</b> index <b><</b> num_south<b>;</b> index<b>++)</b> </p> <p> <b>{</b></p> <p> // Does a north thread have to be created?</p> <p> <b>if</b> <b>(</b>index <b><</b> num_north<b>)</b> </p> <p> <b>{</b></p> <p> // Store the thread number</p> <p> north_nums<b>[</b>index<b>]</b> <b>=</b> index <b>+</b> 1<b>;</b></p> <p> // Create a thread</p> <p> ret <b>=</b> pthread_create<b>(&</b>north_ids<b>[</b>index<b>],</b> </p> <p> attr<b>,</b> north_runner<b>,</b></p> <p> north_nums <b>+</b> index<b>);</b></p> <p> <b>if</b> <b>(</b>ret <b>!=</b> 0<b>)</b> </p> <p> <b>{</b></p> <p> printf<b>(</b>"Couldn't create north thread "</p> <p> "number %d\n"<b>,</b> index <b>+</b> 1<b>);</b></p> <p> north_ids<b>[</b>index<b>]</b> <b>=</b> <b>-</b>1<b>;</b></p> <p> <b>}</b></p> <p> <b>}</b></p> <p> // Does a south thread have to be created?</p> <p> <b>if</b> <b>(</b>index <b><</b> num_south<b>)</b> </p> <p> <b>{</b></p> <p> // Store the thread number</p> <p> south_nums<b>[</b>index<b>]</b> <b>=</b> index <b>+</b> 1<b>;</b></p> <p> // Create a thread</p> <p> ret <b>=</b> pthread_create<b>(</b>south_ids <b>+</b> index<b>,</b> </p> <p> attr<b>,</b> south_runner<b>,</b></p> <p> south_nums <b>+</b> index<b>);</b></p> <p> <b>if</b> <b>(</b>ret <b>!=</b> 0<b>)</b> </p> <p> <b>{</b></p> <p> printf<b>(</b>"Couldn't create south thread "</p> <p> "number %d\n"<b>,</b> index <b>+</b> 1<b>);</b></p> <p> south_ids<b>[</b>index<b>]</b> <b>=</b> <b>-</b>1<b>;</b></p> <p> <b>}</b></p> <p> <b>}</b></p> <p> <b>}</b></p> <p> <b>return</b> 0<b>;</b></p> <p> <b>}</b> </p> <p>Define the method destroy_threads which is use for destroying the threads created. </p> <p>void destroy_threads<b>(</b>pthread_t <b>*</b>north_ids<b>,</b></p> <p> pthread_t <b>*</b>south_ids<b>,</b></p> <p> int <b>*</b>north_nums<b>,</b></p> <p> int <b>*</b>south_nums<b>,</b></p> <p> const int num_north<b>,</b></p> <p> const int num_south<b>)</b></p> <p> <b>{</b> </p> <p> // Used to index into the thread_ids array</p> <p> int index<b>;</b></p> <p> // The value returned by functions</p> <p> int ret<b>;</b></p> <p>Check the condition using the if statement. </p> <p> <b>if</b> <b>(!</b>north_ids <b>||</b> <b>!</b>south_ids </p> <p> <b>||</b> <b>!</b>north_nums <b>||</b> <b>!</b>south_nums<b>)</b></p> <p> <b>return</b><b>;</b></p> <p> // Loop to wait for the threads to exit</p> <p> <b>for</b> <b>(</b>index <b>=</b> 0<b>;</b> index <b><</b> NUM_NORTH</p> <p> <b>||</b> index <b><</b> NUM_SOUTH<b>;</b> index<b>++)</b> </p> <p> <b>{</b></p> <p> // Does a north thread have to be waited for?</p> <p> <b>if</b> <b>(</b>index <b><</b> NUM_NORTH <b>&&</b> north_ids<b>[</b>index<b>]</b> <b>>=</b> 0<b>)</b> </p> <p> <b>{</b></p> <p> // Wait for a thread to exit</p> <p> ret <b>=</b> pthread_join<b>(</b>north_ids<b>[</b>index<b>],</b> <b>NULL</b><b>);</b></p> <p> <b>if</b> <b>(</b>ret <b>!=</b> 0<b>)</b></p> <p> printf<b>(</b>"pthread_join didn't work for "</p> <p> "north thread num %2d\n"<b>,</b></p> <p> north_nums<b>[</b>index<b>]);</b></p> <p> <b>}</b></p> <p> // Does a south thread have to be waited for?</p> <p> <b>if</b> <b>(</b>index <b><</b> NUM_SOUTH <b>&&</b> south_ids<b>[</b>index<b>]</b> <b>>=</b> 0<b>)</b> </p> <p> <b>{</b></p> <p> // Wait for a thread to exit</p> <p> ret <b>=</b> pthread_join<b>(</b>south_ids<b>[</b>index<b>],</b> <b>NULL</b><b>);</b></p> <p> <b>if</b> <b>(</b>ret <b>!=</b> 0<b>)</b></p> <p> printf<b>(</b>"pthread_join didn't work for "</p> <p> "south thread num %2d\n"<b>,</b></p> <p> south_nums<b>[</b>index<b>]);</b></p> <p> <b>}</b></p> <p> <b>}</b></p> <p> <b>}</b> </p> <p>Define the method north_runner which takes one value as an arguments and the thread runner function for a farmer from North Tunbridge.</p> <p>void <b>*</b>north_runner<b>(</b>void <b>*</b>param<b>)</b></p> <p> <b>{</b> </p> <p> // Get the number of this thread</p> <p> int num <b>=</b> <b>*((</b>__typeof__<b>(&</b>num<b>))</b> param<b>);</b></p> <p> printf<b>(</b>"Farmer #%2d from North Tunbridge "</p> <p> "waiting...\n"<b>,</b> num<b>);</b></p> <p> // Enter the bridge</p> <p> north_enter<b>();</b></p> <p> printf<b>(</b>"Farmer #%2d from North Tunbridge "</p> <p> "crossing the bridge...\n"<b>,</b> num<b>);</b></p> <p> // Sleep to simulate crossing the bridge</p> <p> sleep<b>(</b>rand<b>()</b> <b>%</b> MAX_CROSSING_TIME <b>+</b> 1<b>);</b></p> <p> // Exit the bridge</p> <p> north_exit<b>();</b></p> <p> printf<b>(</b>"Farmer #%2d from North Tunbridge "</p> <p> "crossed the bridge\n"<b>,</b> num<b>);</b></p> <p> // Exit from this thread</p> <p> pthread_exit<b>(</b>0<b>);</b></p> <p> <b>}</b> </p> <p>Define the method south_runner which takes one value as an arguments and the thread runner function for a farmer from South Tunbridge.</p> <p>void <b>*</b>south_runner<b>(</b>void <b>*</b>param<b>)</b></p> <p> <b>{</b> </p> <p> // Get the number of this thread</p> <p> int num <b>=</b> <b>*((</b>__typeof__<b>(&</b>num<b>))</b> param<b>);</b></p> <p> printf<b>(</b>"Farmer #%2d from South Tunbridge "</p> <p> "waiting...\n"<b>,</b> num<b>);</b></p> <p> // Enter the bridge</p> <p> south_enter<b>();</b></p> <p> printf<b>(</b>"Farmer #%2d from South Tunbridge "</p> <p> "crossing the bridge...\n"<b>,</b> num<b>);</b></p> <p> // Sleep to simulate crossing the bridge</p> <p> sleep<b>(</b>rand<b>()</b> <b>%</b> MAX_CROSSING_TIME <b>+</b> 1<b>);</b></p> <p> // Exit the bridge</p> <p> south_exit<b>();</b></p> <p> printf<b>(</b>"Farmer #%2d from South Tunbridge "</p> <p> "crossed the bridge\n"<b>,</b> num<b>);</b></p> <p> // Exit from this thread</p> <p> pthread_exit<b>(</b>0<b>);</b></p> <p> <b>}</b> </p> <p>Define the method north_enter to enter the bridge from the north side. </p> <p>void north_enter<b>(</b>void<b>)</b></p> <p> <b>{</b> </p> <p> // Lock the mutex</p> <p> pthread_mutex_lock<b>(&</b>s_mutex<b>);</b></p> <p> // Increment the number of farmers</p> <p> // waiting on the north side</p> <p> s_num_north_waiting<b>++;</b></p> <p>while one of the following are true a. farmers crossing the bridge from the south, b. farmers are waiting on the south side and the direction is south</p> <p> <b>while</b> <b>(</b>s_num_south <b>></b> 0</p> <p> <b>||</b> <b>(</b>s_num_south_waiting <b>></b> 0</p> <p> <b>&&</b> s_direction <b>==</b> SOUTH<b>))</b></p> <p> // Wait on the condition variable</p> <p> pthread_cond_wait<b>(&</b>s_cond<b>,</b> <b>&</b>s_mutex<b>);</b></p> <p> // Set the direction to the north</p> <p> s_direction <b>=</b> NORTH<b>;</b></p> <p> // Decrement the farmers waiting to cross the bridge</p> <p> s_num_north_waiting<b>--;</b></p> <p> // One more farmer is crossing from the north</p> <p> s_num_north<b>++;</b></p> <p> // Unlock the mutex</p> <p> pthread_mutex_unlock<b>(&</b>s_mutex<b>);</b></p> <p> <b>}</b> </p> <p>Define the method north_exit which exit the bridge after entering it from the north. </p> <p>void north_exit<b>(</b>void<b>)</b></p> <p> <b>{</b> </p> <p> // Lock the mutex</p> <p> pthread_mutex_lock<b>(&</b>s_mutex<b>);</b></p> <p> // Decrement the number of farmers</p> <p> // crossing the bridge from the north</p> <p> s_num_north<b>--;</b></p> <p> // Set the direction to the south</p> <p> s_direction <b>=</b> SOUTH<b>;</b></p> <p>Checking the condition are no farmers crossing the bridge from the north.</p> <p> <b>if</b> <b>(</b>s_num_north <b>==</b> 0<b>)</b></p> <p> // Broadcast that the state of the</p> <p> // condition variable has changed</p> <p> pthread_cond_broadcast<b>(&</b>s_cond<b>);</b></p> <p> // Unlock the mutex</p> <p> pthread_mutex_unlock<b>(&</b>s_mutex<b>);</b></p> <p> <b>}</b> </p> <p>Define the function south_enter which enter the bridge from the south side. </p> <p>void south_enter<b>(</b>void<b>)</b></p> <p> <b>{</b> </p> <p> // Lock the mutex</p> <p> pthread_mutex_lock<b>(&</b>s_mutex<b>);</b></p> <p> // Increment the number of farmers</p> <p> // waiting on the south side</p> <p> s_num_south_waiting<b>++;</b></p> <p>While one of the following is true a. farmers crossing the bridge from the north and b. farmers are waiting on the north side and the direction is north.</p> <p> <b>while</b> <b>(</b>s_num_north <b>></b> 0</p> <p> <b>||</b> <b>(</b>s_num_north_waiting <b>></b> 0</p> <p> <b>&&</b> s_direction <b>==</b> NORTH<b>))</b></p> <p> // Wait on the condition variable</p> <p> pthread_cond_wait<b>(&</b>s_cond<b>,</b> <b>&</b>s_mutex<b>);</b></p> <p> // Set the direction to the south</p> <p> s_direction <b>=</b> SOUTH<b>;</b></p> <p> // Decrement the farmers waiting to cross the bridge</p> <p> s_num_south_waiting<b>--;</b></p> <p> // One more farmer is crossing from the south</p> <p> s_num_south<b>++;</b></p> <p> // Unlock the mutex</p> <p> pthread_mutex_unlock<b>(&</b>s_mutex<b>);</b></p> <p> <b>}</b> </p> <p>Define the function south_exit which exit the bridge after entering it from the south. </p> <p>void south_exit<b>(</b>void<b>)</b></p> <p> <b>{</b> </p> <p> // Lock the mutex</p> <p> pthread_mutex_lock<b>(&</b>s_mutex<b>);</b></p> <p> // Decrement the number of farmers</p> <p> // crossing the bridge from the south</p> <p> s_num_south<b>--;</b></p> <p> // Set the direction to the north</p> <p> s_direction <b>=</b> NORTH<b>;</b></p> <p>Checking whether the farmer is crossing the bridge from the south or not.</p> <p> <b>if</b> <b>(</b>s_num_south <b>==</b> 0<b>)</b></p> <p> // Broadcast that the state of the</p> <p> // condition variable has changed</p> <p> pthread_cond_broadcast<b>(&</b>s_cond<b>);</b></p> <p> // Unlock the mutex</p> <p> pthread_mutex_unlock<b>(&</b>s_mutex<b>);</b></p> <p> <b>}</b> </p> </div>
<h2>Step-4</h2>
<div class="answer"> <p> <b>Sample Output:</b> </p> <p>Farmer # 1 from North Tunbridge waiting...</p> <p>Farmer # 1 from North Tunbridge crossing the bridge...</p> <p>Farmer # 2 from North Tunbridge waiting...</p> <p>Farmer # 2 from North Tunbridge crossing the bridge...</p> <p>Farmer # 2 from South Tunbridge waiting...</p> <p>Farmer # 3 from North Tunbridge waiting...</p> <p>Farmer # 3 from North Tunbridge crossing the bridge...</p> <p>Farmer # 3 from South Tunbridge waiting...</p> <p>Farmer # 4 from North Tunbridge waiting...</p> <p>Farmer # 4 from North Tunbridge crossing the bridge...</p> <p>Farmer # 4 from South Tunbridge waiting...</p> <p>Farmer # 5 from North Tunbridge waiting...</p> <p>Farmer # 5 from North Tunbridge crossing the bridge...</p> <p>Farmer # 5 from South Tunbridge waiting...</p> <p>Farmer # 6 from North Tunbridge waiting...</p> <p>Farmer # 6 from North Tunbridge crossing the bridge...</p> <p>Farmer # 6 from South Tunbridge waiting...</p> <p>Farmer # 7 from North Tunbridge waiting...</p> <p>Farmer # 7 from North Tunbridge crossing the bridge...</p> <p>Farmer # 7 from South Tunbridge waiting...</p> <p>Farmer # 8 from North Tunbridge waiting...</p> <p>Farmer # 8 from North Tunbridge crossing the bridge...</p> <p>Farmer # 8 from South Tunbridge waiting...</p> <p>Farmer # 9 from North Tunbridge waiting...</p> <p>Farmer # 9 from North Tunbridge crossing the bridge...</p> <p>Farmer # 9 from South Tunbridge waiting...</p> <p>Farmer #10 from North Tunbridge waiting...</p> <p>Farmer #10 from North Tunbridge crossing the bridge...</p> <p>Farmer #10 from South Tunbridge waiting...</p> <p>Farmer #11 from North Tunbridge waiting...</p> <p>Farmer #11 from North Tunbridge crossing the bridge...</p> <p>Farmer #11 from South Tunbridge waiting...</p> <p>Farmer # 1 from South Tunbridge waiting...</p> <p>Farmer #12 from North Tunbridge waiting...</p> <p>Farmer #12 from North Tunbridge crossing the bridge...</p> <p>Farmer #12 from South Tunbridge waiting...</p> <p>Farmer #13 from North Tunbridge waiting...</p> <p>Farmer #13 from North Tunbridge crossing the bridge...</p> <p>Farmer #13 from South Tunbridge waiting...</p> <p>Farmer #14 from North Tunbridge waiting...</p> <p>Farmer #14 from North Tunbridge crossing the bridge...</p> <p>Farmer #14 from South Tunbridge waiting...</p> <p>Farmer #15 from North Tunbridge waiting...</p> <p>Farmer #15 from North Tunbridge crossing the bridge...</p> <p>Farmer #15 from South Tunbridge waiting...</p> <p>Farmer #16 from North Tunbridge waiting...</p> <p>Farmer #16 from North Tunbridge crossing the bridge...</p> <p>Farmer #16 from South Tunbridge waiting...</p> <p>Farmer #17 from North Tunbridge waiting...</p> <p>Farmer #17 from North Tunbridge crossing the bridge...</p> <p>Farmer #17 from South Tunbridge waiting...</p> <p>Farmer #18 from North Tunbridge waiting...</p> <p>Farmer #18 from North Tunbridge crossing the bridge...</p> <p>Farmer #18 from South Tunbridge waiting...</p> <p>Farmer #19 from North Tunbridge waiting...</p> <p>Farmer #19 from North Tunbridge crossing the bridge...</p> <p>Farmer #19 from South Tunbridge waiting...</p> <p>Farmer #20 from North Tunbridge waiting...</p> <p>Farmer #20 from North Tunbridge crossing the bridge...</p> <p>Farmer #20 from South Tunbridge waiting...</p> <p>Farmer # 5 from North Tunbridge crossed the bridge</p> <p>Farmer # 6 from North Tunbridge crossed the bridge</p> <p>Farmer # 8 from North Tunbridge crossed the bridge</p> <p>Farmer #10 from North Tunbridge crossed the bridge</p> <p>Farmer #16 from North Tunbridge crossed the bridge</p> <p>Farmer # 3 from North Tunbridge crossed the bridge</p> <p>Farmer #12 from North Tunbridge crossed the bridge</p> <p>Farmer #13 from North Tunbridge crossed the bridge</p> <p>Farmer #17 from North Tunbridge crossed the bridge</p> <p>Farmer #18 from North Tunbridge crossed the bridge</p> <p>Farmer # 2 from North Tunbridge crossed the bridge</p> <p>Farmer # 7 from North Tunbridge crossed the bridge</p> <p>Farmer # 9 from North Tunbridge crossed the bridge</p> <p>Farmer # 1 from North Tunbridge crossed the bridge</p> <p>Farmer #14 from North Tunbridge crossed the bridge</p> <p>Farmer #15 from North Tunbridge crossed the bridge</p> <p>Farmer #20 from North Tunbridge crossed the bridge</p> <p>Farmer # 4 from North Tunbridge crossed the bridge</p> <p>Farmer #11 from North Tunbridge crossed the bridge</p> <p>Farmer #19 from North Tunbridge crossed the bridge</p> <p>Farmer # 2 from South Tunbridge crossing the bridge...</p> <p>Farmer # 3 from South Tunbridge crossing the bridge...</p> <p>Farmer # 4 from South Tunbridge crossing the bridge...</p> <p>Farmer # 5 from South Tunbridge crossing the bridge...</p> <p>Farmer # 6 from South Tunbridge crossing the bridge...</p> <p>Farmer # 7 from South Tunbridge crossing the bridge...</p> <p>Farmer # 8 from South Tunbridge crossing the bridge...</p> <p>Farmer # 9 from South Tunbridge crossing the bridge...</p> <p>Farmer #10 from South Tunbridge crossing the bridge...</p> <p>Farmer #11 from South Tunbridge crossing the bridge...</p> <p>Farmer # 1 from South Tunbridge crossing the bridge...</p> <p>Farmer #12 from South Tunbridge crossing the bridge...</p> <p>Farmer #13 from South Tunbridge crossing the bridge...</p> <p>Farmer #14 from South Tunbridge crossing the bridge...</p> <p>Farmer #15 from South Tunbridge crossing the bridge...</p> <p>Farmer #16 from South Tunbridge crossing the bridge...</p> <p>Farmer #17 from South Tunbridge crossing the bridge...</p> <p>Farmer #18 from South Tunbridge crossing the bridge...</p> <p>Farmer #19 from South Tunbridge crossing the bridge...</p> <p>Farmer #20 from South Tunbridge crossing the bridge...</p> <p>Farmer # 3 from South Tunbridge crossed the bridge</p> <p>Farmer # 7 from South Tunbridge crossed the bridge</p> <p>Farmer #10 from South Tunbridge crossed the bridge</p> <p>Farmer # 8 from South Tunbridge crossed the bridge</p> <p>Farmer #13 from South Tunbridge crossed the bridge</p> <p>Farmer # 1 from South Tunbridge crossed the bridge</p> <p>Farmer # 6 from South Tunbridge crossed the bridge</p> <p>Farmer # 4 from South Tunbridge crossed the bridge</p> <p>Farmer # 5 from South Tunbridge crossed the bridge</p> <p>Farmer #14 from South Tunbridge crossed the bridge</p> <p>Farmer #11 from South Tunbridge crossed the bridge</p> <p>Farmer #18 from South Tunbridge crossed the bridge</p> <p>Farmer #20 from South Tunbridge crossed the bridge</p> <p>Farmer # 2 from South Tunbridge crossed the bridge</p> <p>Farmer #19 from South Tunbridge crossed the bridge</p> <p>Farmer #16 from South Tunbridge crossed the bridge</p> <p>Farmer #15 from South Tunbridge crossed the bridge</p> <p>Farmer #12 from South Tunbridge crossed the bridge</p> <p>Farmer # 9 from South Tunbridge crossed the bridge</p> <p>Farmer #17 from South Tunbridge crossed the bridge</p></div>
