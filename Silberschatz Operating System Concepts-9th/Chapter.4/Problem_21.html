<h2>Step-1</h2>
<div class="answer"> <p> <b>Program Plan:</b> </p> <p>• Declare and define the method for initializing the values buffer which takes two values as arguments. </p> <p>• Declare and define the method for the thread that calculates the average and it takes one parameter as arguments. </p> <p>• Declare and define the method for the thread that calculates the minimum value. </p> <p>• Declare and define the method for the thread that calculates the maximum value. </p> <p>• Variable which is use for representing average, minimum and maximum values is stored globally. </p> <p>• Worker thread is responsible for setting the values, and parents thread is responsible for outputting the values. </p> </div>
<h2>Step-2</h2>
<div class="answer"> <p> <b>Program:</b> </p> <p>/*********************************************************** The program for finding average, minimum and maximum * * value * **********************************************************/</p> <p>Include a header file for performing the operation. </p> <p>#include <stdio.h></p> <p>#include <stdlib.h></p> <p>#include <pthread.h></p> <p>// A buffer to hold the values input</p> <p>static int <b>*</b>values <b>=</b> <b>NULL</b><b>;</b></p> <p>// The size of the buffer</p> <p>static int size <b>=</b> 0<b>;</b></p> <p>// The average of the list of numbers</p> <p>static float average<b>;</b></p> <p>// The minimum of the list of numbers</p> <p>static int minimum<b>;</b></p> <p>// The maximum of the list of numbers</p> <p>static int maximum<b>;</b></p> <p>Declare the method for initializing the values buffer which takes two values as arguments. </p> <p>int init_values<b>(</b>int argc<b>,</b> char <b>**</b>argv<b>);</b></p> <p>Declare the method for the thread that calculates the average and it takes one parameter as arguments. </p> <p>void <b>*</b>average_value<b>(</b>void <b>*</b>param<b>);</b></p> <p>Declare the method for the thread that calculates the minimum value. </p> <p>void <b>*</b>minimum_value<b>(</b>void <b>*</b>param<b>);</b></p> <p>Declare the method for the thread that calculates the maximum value. </p> <p>void <b>*</b>maximum_value<b>(</b>void <b>*</b>param<b>);</b></p> <p>Define the main method from where the execution of the program begins.</p> <p> </p> <p>int main<b>(</b>int argc<b>,</b> char <b>**</b>argv<b>)</b></p> <p> <b>{</b> </p> <p> // The pthread's attributes</p> <p> pthread_attr_t attr<b>;</b></p> <p> // The ids of the threads that calculate</p> <p> // the average, the minimum and the maximum</p> <p> pthread_t average_id<b>,</b> minimum_id<b>,</b> maximum_id<b>;</b></p> <p> // The return value of functions</p> <p> int ret<b>;</b></p> <p>Checking the condition whether the list of the arguments is being pass or not. </p> <p> <b>if</b> <b>(</b>argc <b>==</b> 1<b>)</b> </p> <p> <b>{</b></p> <p> printf<b>(</b>"%s [list of values]\n"<b>,</b> <b>*</b>argv<b>);</b></p> <p> <b>return</b> 1<b>;</b></p> <p> <b>}</b></p> <p> // Initialize the values buffer</p> <p> ret <b>=</b> init_values<b>(</b>argc <b>-</b> 1<b>,</b> argv <b>+</b> 1<b>);</b></p> <p>Checking the condition whether the value of ret is less than 0 or not. </p> <p> <b>if</b> <b>(</b>ret <b><</b> 0<b>)</b></p> <p> <b>return</b> 2<b>;</b></p> <p> // Initialize the pthreads library</p> <p> <b>if</b> <b>(</b>pthread_attr_init<b>(&</b>attr<b>)</b> <b>!=</b> 0<b>)</b> </p> <p> <b>{</b></p> <p> fputs<b>(</b>"pthread_attr_init didn't work\n"<b>,</b> stdout<b>);</b></p> <p> // Free the values buffer</p> <p> </div>
<h2>Step-3</h2>
<div class="answer"> free<b>(</b>values<b>);</b></p> <p> <b>return</b> 3<b>;</b></p> <p> <b>}</b></p> <p> // Create the thread that finds the average value</p> <p> ret <b>=</b> pthread_create<b>(&</b>average_id<b>,</b> <b>&</b>attr<b>,</b></p> <p> average_value<b>,</b> <b>NULL</b><b>);</b></p> <p> <b>if</b> <b>(</b>ret <b>!=</b> 0<b>)</b> </p> <p> <b>{</b></p> <p> printf<b>(</b>"Couldn't create average value thread\n"<b>);</b></p> <p> // Free the values buffer</p> <p> free<b>(</b>values<b>);</b></p> <p> <b>return</b> 4<b>;</b></p> <p> <b>}</b></p> <p>Create the thread that finds the minimum value.</p> <p> ret <b>=</b> pthread_create<b>(&</b>minimum_id<b>,</b> <b>&</b>attr<b>,</b></p> <p> minimum_value<b>,</b> <b>NULL</b><b>);</b></p> <p> <b>if</b> <b>(</b>ret <b>!=</b> 0<b>)</b> </p> <p> <b>{</b></p> <p> printf<b>(</b>"Couldn't create minimum value thread\n"<b>);</b></p> <p> // Free the values buffer</p> <p> free<b>(</b>values<b>);</b></p> <p> <b>return</b> 4<b>;</b></p> <p> <b>}</b></p> <p> // Create the thread that finds the maximum value</p> <p> ret <b>=</b> pthread_create<b>(&</b>maximum_id<b>,</b> <b>&</b>attr<b>,</b></p> <p> maximum_value<b>,</b> <b>NULL</b><b>);</b></p> <p>Checking the condition whether ret is equal to 0 or not. </p> <p> <b>if</b> <b>(</b>ret <b>!=</b> 0<b>)</b> </p> <p> <b>{</b></p> <p> printf<b>(</b>"Couldn't create maximum value thread\n"<b>);</b></p> <p> // Free the values buffer</p> <p> free<b>(</b>values<b>);</b></p> <p> <b>return</b> 4<b>;</b></p> <p> <b>}</b></p> <p> // Wait for the average value thread to exit</p> <p> // and print out the average value</p> <p> <b>if</b> <b>(</b>pthread_join<b>(</b>average_id<b>,</b> <b>NULL</b><b>)</b> <b>==</b> 0<b>)</b></p> <p> printf<b>(</b>"The average value is %f\n"<b>,</b> average<b>);</b></p> <p> <b>else</b></p> <p> fputs<b>(</b>"pthread_join didn't work for "</p> <p> "average value thread"<b>,</b> stdout<b>);</b></p> <p> // Wait for the minimum value thread to exit</p> <p> // and print out the minimum value</p> <p> <b>if</b> <b>(</b>pthread_join<b>(</b>minimum_id<b>,</b> <b>NULL</b><b>)</b> <b>==</b> 0<b>)</b></p> <p> printf<b>(</b>"The minimum value is %d\n"<b>,</b> minimum<b>);</b></p> <p> <b>else</b></p> <p> fputs<b>(</b>"pthread_join didn't work for "</p> <p> "minimum value thread"<b>,</b> stdout<b>);</b></p> <p> // Wait for the maximum value thread to exit</p> <p> // and print out the maximum value</p> <p> <b>if</b> <b>(</b>pthread_join<b>(</b>maximum_id<b>,</b> <b>NULL</b><b>)</b> <b>==</b> 0<b>)</b></p> <p> printf<b>(</b>"The maximum value is %d\n"<b>,</b> maximum<b>);</b></p> <p> <b>else</b></p> <p> fputs<b>(</b>"pthread_join didn't work for "</p> <p> "maximum value thread"<b>,</b> stdout<b>);</b></p> <p> // De-init the pthreads library</p> <p> pthread_attr_destroy<b>(&</b>attr<b>);</b></p> <p> // Free the values buffer</p> <p> free<b>(</b>values<b>);</b></p> <p> <b>return</b> 0<b>;</b></p> <p> <b>}</b> </p> <p>Define the method init_values which takes two values as an arguments and it is use for initializing the values buffer. </p> <p>int init_values<b>(</b>int argc<b>,</b> char <b>**</b>argv<b>)</b></p> <p> <b>{</b> </p> <p> // The index into the passed arguments</p> <p> int index<b>;</b></p> <p> // Are the passed arguments valid?</p> <p> <b>if</b> <b>(</b>argc <b><</b> 1 <b>||</b> <b>!</b>argv<b>)</b></p> <p> <b>return</b> <b>-</b>1<b>;</b></p> <p> // Allocate space to the values buffer</p> <p> values <b>=</b> <b>(</b>__typeof__<b>(</b>values<b>))</b> </p> <p> malloc<b>(</b>argc <b>*</b> <b>sizeof</b><b>(*</b>values<b>));</b></p> <p> <b>if</b> <b>(!</b>values<b>)</b> <b>{</b></p> <p> printf<b>(</b>"Couldn't allocate %lu bytes\n"<b>,</b></p> <p> argc <b>*</b> <b>sizeof</b><b>(*</b>values<b>));</b></p> <p> <b>return</b> <b>-</b>2<b>;</b></p> <p> <b>}</b></p> <p> // Set the size of the buffer</p> <p> size <b>=</b> argc<b>;</b></p> <p> // Fill in the values in the buffer</p> <p> <b>for</b> <b>(</b>index <b>=</b> 0<b>;</b> index <b><</b> argc<b>;</b> index<b>++)</b></p> <p> values<b>[</b>index<b>]</b> <b>=</b> atoi<b>(</b>argv<b>[</b>index<b>]);</b></p> <p> <b>return</b> 0<b>;</b></p> <p> <b>}</b> </p> <p>Define the method average_value which takes one value as arguments to calculate the average of the integers in the values buffer. </p> <p>void <b>*</b>average_value<b>(</b>void <b>*</b>param<b>)</b></p> <p> <b>{</b> </p> <p> // Does the values buffer exist</p> <p> // and is its size valid?</p> <p> <b>if</b> <b>(</b>values <b>&&</b> size <b>></b> 0<b>)</b> </p> <p> <b>{</b></p> <p> // Index into the values buffer</p> <p> int index<b>;</b></p> <p> // Set the average to the 1st element</p> <p> average <b>=</b> values<b>[</b>0<b>];</b></p> <p> // For the rest of the values in the buffer</p> <p> <b>for</b> <b>(</b>index <b>=</b> 1<b>;</b> index <b><</b> size<b>;</b> index<b>++)</b></p> <p> // Add the value to the average</p> <p> average <b>+=</b> values<b>[</b>index<b>];</b></p> <p> // Divide by size to get the average</p> <p> average <b>/=</b> size<b>;</b></p> <p> <b>}</b></p> <p> // Exit from this thread</p> <p> pthread_exit<b>(</b>0<b>);</b></p> <p> <b>}</b> </p> <p>Define the method minimum_value which take one value as an argument and calculate the minimum of the integers in the value buffer. </p> <p>void <b>*</b>minimum_value<b>(</b>void <b>*</b>param<b>)</b></p> <p> <b>{</b> </p> <p> // Does the values buffer exist</p> <p> // and is its size valid?</p> <p> <b>if</b> <b>(</b>values <b>&&</b> size <b>></b> 0<b>)</b> </p> <p> <b>{</b></p> <p> // Index into the values buffer</p> <p> int index<b>;</b></p> <p> // Set the minimum to the 1st element</p> <p> minimum <b>=</b> values<b>[</b>0<b>];</b></p> <p> // For the rest of the values in the buffer</p> <p> <b>for</b> <b>(</b>index <b>=</b> 1<b>;</b> index <b><</b> size<b>;</b> index<b>++)</b></p> <p> // Is the minimum greater than this element</p> <p> <b>if</b> <b>(</b>minimum <b>></b> values<b>[</b>index<b>])</b></p> <p> // Update the value of the minimum</p> <p> minimum <b>=</b> values<b>[</b>index<b>];</b></p> <p> <b>}</b></p> <p> // Exit from this thread</p> <p> pthread_exit<b>(</b>0<b>);</b></p> <p> <b>}</b> </p> <p>Define the method maximum_value which take one value as an arguments and thus calculate the maximum of the integers in the values buffer. </p> <p>void <b>*</b>maximum_value<b>(</b>void <b>*</b>param<b>)</b></p> <p> <b>{</b> </p> <p> // Does the values buffer exist</p> <p> // and is its size valid?</p> <p> <b>if</b> <b>(</b>values <b>&&</b> size <b>></b> 0<b>)</b> </p> <p> <b>{</b></p> <p> // Index into the values buffer</p> <p> int index<b>;</b></p> <p> // Set the maximum to the 1st element</p> <p> maximum <b>=</b> values<b>[</b>0<b>];</b></p> <p> // For the rest of the values in the buffer</p> <p> <b>for</b> <b>(</b>index <b>=</b> 1<b>;</b> index <b><</b> size<b>;</b> index<b>++)</b></p> <p> // Is the maximum less than this element</p> <p> <b>if</b> <b>(</b>maximum <b><</b> values<b>[</b>index<b>])</b></p> <p> // Update the value of the maximum</p> <p> maximum <b>=</b> values<b>[</b>index<b>];</b></p> <p> <b>}</b></p> <p> // Exit from this thread</p> <p> pthread_exit<b>(</b>0<b>);</b></p> <p> <b>}</b> </p> </div>
<h2>Step-4</h2>
<div class="answer"> <p> <b>Sample Output:</b> </p> <p>11:09 4$ ./13258-4-21PP 90 81 78 95 79 72 85</p> <p>The average value is 82.857140</p> <p>The minimum value is 72</p> <p>The maximum value is 95</p></div>
