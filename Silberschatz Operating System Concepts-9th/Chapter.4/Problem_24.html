<h2>Step-1</h2>
<div class="answer"> <p> <b>Program plan:</b> </p> <p>• Include the required library files.</p> <p>• Write a function to print the prime factorization.</p> <p>• Write a function to run the prime computer. </p> <p>• Write the loop to check the prime condition.</p> <p>• Display the messages based on the factorization.</p> <p>• Call the functions in the main.</p> </div>
<h2>Step-2</h2>
<div class="answer"> <p> <b>Program:</b> </p> <p>// include the required library files</p> <p>#include <stdio.h> </p> <p>#include <pthread.h> </p> <p>#include <math.h> </p> <p>#include <stdlib.h> </p> <p>#include <assert.h></p> <p>typedef struct {</p> <p>pthread_cond_t start_working;</p> <p>// mutex to protect the condition variable</p> <p>pthread_mutex_t cond_mutex;</p> <p>// number searched by the thread</p> <p>long max_search;</p> <p>} thread_parameters_t;</p> <p>typedef struct {</p> <p>long f[2];</p> <p>} factor_t;</p> <p>// function to print prime factorization. </p> <p>void print_factorization(long n, factor_t *sieve) {</p> <p>// declare the variable i</p> <p>int i;</p> <p>if (sieve[n].f[0]) {</p> <p>for (i = 0; i < 2; ++i)</p> <p>if (sieve[n].f[i])</p> <p>print_factorization(sieve[n].f[i], sieve);</p> <p>} else</p> <p>printf(" %ld ", n);</p> <p>}</p> <p>// function to run the prime computer </p> <p>void *primes_computer_runner(void *param) {</p> <p>factor_t *sieve;</p> <p>long i, prime, limit;</p> <p>thread_parameters_t *thread_parameters = (thread_parameters_t*)param;</p> <p>pthread_mutex_lock(&thread_parameters->cond_mutex);</p> <p>pthread_cond_wait(&thread_parameters->start_working,</p> <p>&thread_parameters->cond_mutex);</p> <p>// thread goes to sleep state untill the condition is true</p> <p>// it woken up when it reaches the next line and signaled </p> <p>// from the main thread</p> <p>printf("Thread woken to find the primes less than %ld.\n",</p> <p>thread_parameters->max_search);</p> <p>sieve = (factor_t*)calloc(thread_parameters->max_search, sizeof(factor_t));</p> <p>assert(sieve != NULL);</p> <p>// calloc allocates the memory and initialize it to zero</p> <p>// use this zero to represent "is prime" according to the algorithm</p> <p>limit = (long)sqrt(thread_parameters->max_search) + 1;</p> <p>// checking for prime condition</p> <p>for (prime = 2; prime <= limit; ++prime)</p> <p>for (i=2; i*prime < thread_parameters->max_search; ++i) {</p> <p>sieve[i*prime].f[0] = i;</p> <p>sieve[i*prime].f[1]= prime;</p> <p>}</p> <p>// display the below message if the number is prime</p> <p>for(i=2; i < thread_parameters->max_search; ++i)</p> <p>if (!sieve[i].f[0])</p> <p>printf("* %ld is prime.\n",i);</p> <p>#ifdef SHOW_NONPRIME</p> <p>//display the below message if the number is nonprime </p> <p>else {</p> <p>printf(" %ld is nonprime, factorization: (",i);</p> <p>print_factorization(i, sieve);</p> <p>puts(")");</p> <p>}</p> <p>#endif</p> <p>free(sieve);</p> <p>return NULL;</p> <p>}</p> <p>// main function begins</p> <p>int main (int argc, char *argv[]) {</p> <p>//pass a pointer to this struct to the computational thread</p> <p>thread_parameters_t thread_parameters;</p> <p>// Set the initial conditions of the thread to null</p> <p>pthread_cond_init(&thread_parameters.start_working, NULL);</p> <p>pthread_mutex_init(&thread_parameters.cond_mutex, NULL);</p> <p>// This thread will do the computing of prime numbers. </p> <p>pthread_t computational_thread;</p> <p>// Create and start new thread.</p> <p>pthread_create(&computational_thread, NULL, primes_computer_runner,</p> <p>(void*)&thread_parameters);</p> <p>puts("Enter an integer \n"</p> <p>#ifdef SHOW_NONPRIME</p> <p>"This program has been compiled to show prime factorizations of \n"</p> <p>"the nonprimes it finds, with -DSHOW_NONPRIME in the Makefile.\n"</p> <p>#endif</p> <p>);</p> <p>// Get the integer from the user </p> <p>if (!scanf("%ld", &thread_parameters.max_search)) return 0;</p> <p>// Wake up the thread to do the computation. </p> <p>pthread_cond_broadcast(&thread_parameters.start_working);</p> <p>//Wait for it to finish (makes this rather pointless, but I forgot</p> <p>//about this assignment until the eleventh hour.) </p> <p>pthread_join(computational_thread,NULL);</p> <p>return 0;</p> <p>}</p> </div>
<h2>Step-3</h2>
<div class="answer"> <p> <b>Sample output 1:</b> </p> <p> <img src="https://media.cheggcdn.com/study/fd1/fd17e6f2-e6b0-4190-b852-e125c4287b2d/13258-4-24PP-i1.png" alt="Picture 1" /> </p> <p> <b>Sample output 2:</b> </p> <p> <img src="https://media.cheggcdn.com/study/eec/eec0f1c3-4b35-4c51-9c1c-dc03bc6c423a/13258-4-24PP-i2.png" alt="Picture 2" /> </p></div>
