<h2>Step-1</h2>
<div class="answer"> <p>Some special hardware instructions are given by many machines that are used to test and swap the content of words automatically.</p> <p>The functions test_and_set() and compare_and_swap() are the two hardware instruction used for the same.</p> <p> </p> <p> <b>Mutex structure is defined as:</b> </p> <p> <b>typedef</b> struct</p> <p> <b>{</b> </p> <p> int available<b>;</b></p> <p> <b>}</b>lock<b>;</b></p> </div>
<h2>Step-2</h2>
<div class="answer"> <p> <b>Implementation using </b> <b>test_and_set()</b> <b>:</b> </p> <p>• In the lock struct, when the variable “available == 1”, it means that lock is not available. However when “available == 0” means that lock is released and available. </p> <p>• The function test_and_set() provides mutual exclusion and is implemented automatically. Definition of the instruction is provided below as:</p> <p>boolean test_and_set<b>(</b>boolean <b>*</b>target<b>)</b></p> <p> <b>{</b> </p> <p> boolean rv <b>=*</b>target<b>;</b></p> <p> <b>*</b>target <b>=</b> true<b>;</b></p> <p> <b>return</b> rv<b>;</b></p> <p> <b>}</b> </p> <p>• Initialization of the lock is done in init(lock *mutex) function in which the variable available is initialized as 0 which means it is available and can be locked by some thread.</p> <p>• Then, in the function acquire(lock *mutex), atomic hardware instruction test_and_set() is called when it is locked by some thread to do thread’s processing.</p> <p>• The function release(lock * mutex) clears the value of the variable available to 0.</p> </div>
<h2>Step-3</h2>
<div class="answer"> <p> <b>The definitions of functions are as follows:</b> </p> <p>void init<b>(</b>lock <b>*</b>mutex<b>)</b></p> <p> <b>{</b> </p> <p> //lock is available at value 0, 1 otherwise.</p> <p> mutex<b>-></b>available<b>=</b>0<b>;</b></p> <p> <b>}</b> </p> <p>void acquire<b>(</b>lock <b>*</b> mutex<b>)</b></p> <p> <b>{</b> </p> <p> // keep on testing the mutex until it is </p> <p> // acquired</p> <p> <b>while</b><b>(</b>test_and_set<b>(&</b>mutex<b>-></b>available<b>,</b> 1<b>)</b> <b>==</b> 1<b>);</b></p> <p> <b>}</b> </p> <p>void release<b>(</b>lock <b>*</b> mutex<b>)</b></p> <p> <b>{</b> </p> <p> // release the mutex by clearing the </p> <p> // available to 0</p> <p> mutex<b>-></b>available<b>=</b>0<b>;</b></p> <p> <b>}</b> </p> </div>
<h2>Step-4</h2>
<div class="answer"> <p> <b>Implementation using </b> <b>compare_and_swap():</b> </p> <p>• The function compare_and_swap() has three parameters as opposed to the function test_and_set() which has only one parameter. </p> <p>• This instruction returns the original value of the first parameter.</p> <p>• The function compare_and_swap() is defined as below:</p> <p>boolean compare_and_swap<b>(</b>int <b>*</b>value<b>,</b> int expected<b>,</b> </p> <p> int new_value<b>)</b></p> <p> <b>{</b> </p> <p> int temp <b>=</b> <b>*</b>value<b>;</b></p> <p> <b>if</b><b>(</b>value<b>==</b>expected<b>)</b></p> <p> <b>*</b>value <b>=</b> new_value<b>;</b></p> <p> <b>return</b> temp<b>;</b></p> <p> <b>}</b> </p> <p>• In the function compare_and_swap() also, when the variable “available == 1”, it means that lock is not available. However, when “available == 0”, it means that lock is released and available.</p> <p>• The value is updated only if first parameter in compare_and_swap() function is pointing to a value which is same as second parameter, expected, in the compare_and_swap() function.</p> <p>• Similar to test_and_set()function, release(lock * mutex) function clears the value of variable available to 0.</p> </div>
<h2>Step-5</h2>
<div class="answer"> <p> <b>The definitions of fun</b> <b>ctions are as follows:</b> </p> <p>void init<b>(</b>lock <b>*</b>mutex<b>)</b></p> <p> <b>{</b> </p> <p> //lock is available at value 0, 1 otherwise.</p> <p> mutex<b>-></b>available<b>=</b>0<b>;</b></p> <p> <b>}</b> </p> <p>void acquire<b>(</b>lock <b>*</b> mutex<b>)</b></p> <p> <b>{</b> </p> <p> // keep on comparing until the condition</p> <p> // is met</p> <p> <b>while</b><b>(</b>compare_and_swap<b>(</b></p> <p> <b>&</b>mutex<b>-></b>available<b>,</b> 0<b>,</b> 1<b>)</b> <b>==</b> 1<b>);</b></p> <p> <b>}</b> </p> <p>void release<b>(</b>lock <b>*</b> mutex<b>)</b></p> <p> <b>{</b> </p> <p> // set the value of muted to 0</p> <p> <b>&</b>mutex<b>-></b>available<b>=</b>0<b>;</b></p> <p> <b>}</b> </p></div>
