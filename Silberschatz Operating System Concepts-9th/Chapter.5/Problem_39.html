<h2>Step-1</h2>
<div class="answer"> <p> <b>Program Plan:</b> </p> <p>• Define the randf function to calculate a random floating point number in the range [-1,1]</p> <p>• Define the calc_num which takes one value as arguments to calculate the number of randomly chosen points that lie inside a circle with radius equal to 1.0. </p> <p>• Define the main method from where the execution of the program begins. </p> <p>• In the main method creation of the mutex lock is done. </p> <p>• Iterate for loop to create the threads that will calculate the number of randomly chosen points that lie in the circle.</p> <p>• Iterate for loop to wait for the thread to exit.</p> </div>
<h2>Step-2</h2>
<div class="answer"> <p> <b>Program:</b> </p> <p>/*********************************************************** Modify a program so that several thread is created * * which basically generates random points and determining * * whether it fall within the circle. * **********************************************************/ </p> <p>Include a header file for performing the operation. </p> <p>#include <stdio.h></p> <p>#include <stdlib.h></p> <p>#include <pthread.h></p> <p>#include <time.h></p> <p>// The number of times the Monte Carlo technique</p> <p>// will be used</p> <p>const int COUNT <b>=</b> 10000<b>;</b></p> <p>// The number of threads that will be created</p> <p>const int NUMBER <b>=</b> 100<b>;</b></p> <p>// The number of times that the randomly chosen</p> <p>// point lies inside the circle</p> <p>static int num<b>;</b></p> <p>// The pthread mutex lock</p> <p>pthread_mutex_t mutex<b>;</b></p> <p>Declare the randf function to calculate a random floating point number in the range [-1, 1].</p> <p>float randf<b>(</b>void<b>);</b></p> <p>Declare the function calc_num which takes one value as an argument. The start functions for the thread that determines the number of points that lie inside the circle.</p> <p>void <b>*</b>calc_num<b>(</b>void <b>*</b>param<b>);</b></p> <p>Define the main method from where the execution of the program begins. </p> <p>int main<b>(</b>void<b>)</b></p> <p> <b>{</b> </p> <p> // The pthread attributes</p> <p> pthread_attr_t attr<b>;</b></p> <p> // The ids of the threads</p> <p> pthread_t tids<b>[</b>NUMBER<b>];</b></p> <p> // Index into the tids array</p> <p> int index<b>;</b></p> <p> // Initialize the random number generator</p> <p> // with the current time</p> <p> srand<b>(</b>time<b>(</b><b>NULL</b><b>));</b></p> <p> // Create the mutex lock</p> <p> <b>if</b> <b>(</b>pthread_mutex_init<b>(&</b>mutex<b>,</b> <b>NULL</b><b>)</b> <b>!=</b> 0<b>)</b> <b>{</b></p> <p> fputs<b>(</b>"pthread_mutex_init didn't work\n"<b>,</b></p> <p> stdout<b>);</b></p> <p> <b>return</b> 1<b>;</b></p> <p> <b>}</b></p> <p> // Initialize pthreads</p> <p> <b>if</b> <b>(</b>pthread_attr_init<b>(&</b>attr<b>)</b> <b>!=</b> 0<b>)</b> <b>{</b></p> <p> fputs<b>(</b>"pthread_attr_init didn't work\n"<b>,</b></p> <p> stdout<b>);</b></p> <p> // Destroy the mutex</p> <p> pthread_mutex_destroy<b>(&</b>mutex<b>);</b></p> <p> <b>return</b> 2<b>;</b></p> <p> <b>}</b></p> <p> // Zero out the number of points that lie</p> <p> // in the circle</p> <p> num <b>=</b> 0<b>;</b></p> <p>Iterate for loop to create the threads that will calculate the number of randomly chosen points that lie in the circle.</p> <p> <b>for</b> <b>(</b>index <b>=</b> 0<b>;</b> index <b><</b> NUMBER<b>;</b> index<b>++)</b></p> <p> <b>if</b> <b>(</b>pthread_create<b>(&</b>tids<b>[</b>index<b>],</b> <b>&</b>attr<b>,</b></p> <p> calc_num<b>,</b> <b>NULL</b><b>)</b> <b>!=</b> 0<b>)</b> <b>{</b></p> <p> printf<b>(</b>"Couldn't create thread #%d\n"<b>,</b></p> <p> </div>
<h2>Step-3</h2>
<div class="answer"> index<b>);</b></p> <p> // Set the tid to an invalid value</p> <p> tids<b>[</b>index<b>]</b> <b>=</b> <b>-</b>1<b>;</b></p> <p> <b>}</b></p> <p>Iterate for loop to wait for the thread to exit.</p> <p> <b> </b> </p> <p> <b>for</b> <b>(</b>index <b>=</b> 0<b>;</b> index <b><</b> NUMBER<b>;</b> index<b>++)</b></p> <p> <b>if</b> <b>(</b>tids<b>[</b>index<b>]</b> <b>>=</b> 0</p> <p> <b>&&</b> pthread_join<b>(</b>tids<b>[</b>index<b>],</b> <b>NULL</b><b>)</b> <b>!=</b> 0<b>)</b></p> <p> printf<b>(</b>"pthread_join didn't work for "</p> <p> "thread #%d\n"<b>,</b> index<b>);</b></p> <p> // Calculate the value of PI and print it out</p> <p> printf<b>(</b>"PI = %f\n"<b>,</b> 4.0f <b>*</b> num <b>/</b> <b>(</b>COUNT <b>*</b> NUMBER<b>));</b></p> <p> // Destroy the mutex</p> <p> pthread_mutex_destroy<b>(&</b>mutex<b>);</b></p> <p> // De-initialize pthreads</p> <p> pthread_attr_destroy<b>(&</b>attr<b>);</b></p> <p> <b>return</b> 0<b>;</b></p> <p> <b>}</b> </p> <p>Define the randf function to calculate a random floating point number in the range [-1,1]</p> <p>float randf<b>(</b>void<b>)</b></p> <p> <b>{</b> </p> <p> <b>return</b> <b>((</b>float<b>)</b> rand<b>())</b> <b>/</b> RAND_MAX <b>*</b> 2.0f <b>-</b> 1.0f<b>;</b></p> <p> <b>}</b> </p> <p>Define the calc_num which takes one value as arguments to calculate the number of randomly chosen points that lie inside a circle with radius equal to 1.0. </p> <p>void <b>*</b>calc_num<b>(</b>void <b>*</b>param<b>)</b></p> <p> <b>{</b> </p> <p> // Count how many times the points have been chosen</p> <p> int index<b>;</b></p> <p>Iterate for loop to count the times.</p> <p> <b>for</b> <b>(</b>index <b>=</b> 0<b>;</b> index <b><</b> COUNT<b>;</b> index<b>++)</b> </p> <p> <b>{</b></p> <p> // Get a random x co-ordinate</p> <p> float x <b>=</b> randf<b>();</b></p> <p> // Get a random x co-ordinate</p> <p> float y <b>=</b> randf<b>();</b></p> <p> // Is the square of the length of line between</p> <p> // (x, y) and the origin less than or equal to</p> <p> // the square of the radius</p> <p> <b>if</b> <b>(</b>x <b>*</b> x <b>+</b> y <b>*</b> y <b><=</b> 1.0f<b>)</b> <b>{</b></p> <p> // Acquire the mutex</p> <p> pthread_mutex_lock<b>(&</b>mutex<b>);</b></p> <p> // Increment the number of times</p> <p> // the point lied in the circle</p> <p> num<b>++;</b></p> <p> // Release the mutex</p> <p> pthread_mutex_unlock<b>(&</b>mutex<b>);</b></p> <p> <b>}</b></p> <p> <b>}</b></p> <p> // Exit from this thread</p> <p> pthread_exit<b>(</b>0<b>);</b></p> <p> <b>}</b> </p> </div>
<h2>Step-4</h2>
<div class="answer"> <p> <b>Sample Output:</b> </p> <p>18:32 5$ ./13258-5-39PP </p> <p>PI = 3.143444</p> <p>18:33 5$ ./13258-5-39PP </p> <p>PI = 3.141392</p> <p>18:33 5$ ./13258-5-39PP </p> <p>PI = 3.141364</p> <p>18:33 5$ ./13258-5-39PP </p> <p>PI = 3.141512</p></div>
