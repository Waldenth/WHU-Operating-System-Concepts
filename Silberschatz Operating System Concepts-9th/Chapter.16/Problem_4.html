<h2>Step-1</h2>
<div class="answer"> <p> <b>Virtualization</b> means creating abstract hardware of a single computer and allowing multiple OS to run in separate environment.</p> <p> <b>Virtual Machine</b> is one such method of achieving virtualization. There are three different ways to implement virtual machines,</p> <p>1. Add Virtual machine support to the kernel</p> <p>2. Providing Hardware features by the CPU</p> <p>3. Supporting virtual machine implementation using I/O Devices </p> <p> <b>Virtual machine implementation</b> involves several components. At the base is <b>the host</b>, underlying hardware system that runs the virtual machines. The <b>Virtual machine manager (VMM)</b> runs virtual machines by providing an interface that is identical to the host. </p> <p>Several VMM software tools like VMware ESX or Citrix XenServer are available which runs virtual machines on the host.</p> <p>However the ability to virtualize depends on the features provided by the CPU. If the CPU supports virtualization then only it is possible to write a VMM otherwise it is impossible to achieve virtualization.</p> </div>
<h2>Step-2</h2>
<div class="answer"> <p>VMMs use <b>trap-and-emulate technique</b> or <b>binary translation technique</b> to implement virtualization. In either technique a <b>Virtual CPU (VCPU)</b> is implemented. </p> <p>The VCPU does not execute code; it just maintains the current CPU state of the guest operating system. When the guest is context switched on to CPU by VMM, the information from the VCPU is used to load the right context.</p> <p> <b>Problems with trap-and-emulate based virtualization</b> </p> <p>In a typical dual mode system, there are two modes – user mode and kernel mode. Consequently the guest operating system must also have virtual user mode and virtual kernel mode. </p> <p>• But, since it is not safe to allow user level code to run in the kernel, hence both virtual user mode and virtual kernel mode both run in the physical user mode.</p> <p>• Whenever there is a system call or interrupt or an attempt to execute privileged instructions, there is a transfer from user mode to kernel mode on a real machine. Now the same should also be true for virtual environment. This is achieved using the Trap-and-emulate Technique.</p> <p>• Whenever a kernel in the guest OS tries to execute a privileged instruction, it results in an error or a <b>trap</b> to the VMM on real machine, since the guest OS is in the user mode. </p> <p>The VMM gains control and <b>emulates</b> or executes the action attempted by the guest kernel and then returns the control to the virtual machine. This is called Trap-and-Emulate method.</p> <p>Thus it can be seen that privileged instructions create an overhead, which causes the guest to run slowly. Also since CPU is multi-programmed among several virtual machines, it further slows down the virtual machines. Thus time becomes an issue.</p> <p>Also some CPUs do not have clear cut separation about the privileged and non-privileged instructions making it impossible to implement virtualization on such CPUs for example x86.</p> </div>
<h2>Step-3</h2>
<div class="answer"> <p> <b>Alternate technique used by VMMs to implement virtualization</b> </p> <p>The above problem can be solved by implementing <b>binary translation technique</b>. In this technique, if the guest VCPU is in user mode then guest can run its instructions on physical CPU and if guest VCPU is in kernel mode, then VMM examines every instruction. </p> <p>Instructions other than special instructions are run natively and special instructions are translated into new set of instructions that perform equivalent tasks.</p> <p>Binary translation is implemented by translating code within the VMM. The code reads native binary instructions from the guest, on demand and generates native binary code that executes in place of original code.</p> <p>The replacement code for instructions are cached and if the cache is large enough, this method can greatly improve the performance.</p></div>
