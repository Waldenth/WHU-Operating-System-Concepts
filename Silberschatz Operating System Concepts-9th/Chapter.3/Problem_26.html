<h2>Step-1</h2>
<div class="answer"> <p> <b>Program Plan:</b> </p> <p>• Create an index for reading and writing files from pipe.</p> <p>• Initialize the size of buffer.</p> <p>• Create a function write_string that takes the size of string.</p> <p>• Create another function read_buffer that read the string.</p> <p>• Write the main() function that create the pipes. It uses fork function and also calls other function to print string in reverse order.</p> </div>
<h2>Step-2</h2>
<div class="answer"> <p> <b>Program:</b> </p> <p>//Include the header files for performing the operations.</p> <p>#include <stdio.h></p> <p>#include <unistd.h></p> <p>#include <errno.h></p> <p>#include <string.h></p> <p>#include <sys/types.h></p> <p>#include <sys/wait.h></p> <p>// The index of the file descriptor for reading from a pipe</p> <p>const int READ_END <b>=</b> 0<b>;</b></p> <p>// The index of the file descriptor for writing from a pipe</p> <p>const int WRITE_END <b>=</b> 1<b>;</b></p> <p>// The size of the buffer</p> <p>const int BUFFER_SIZE <b>=</b> 512<b>;</b></p> </div>
<h2>Step-3</h2>
<div class="answer"> <p>Write a null terminated string to a file descriptor. </p> <p> </p> <p>ssize_t write_string<b>(</b>int fd<b>,</b> char <b>*</b>string<b>)</b></p> <p> <b>{</b> </p> <p> // Used to store the size of the string</p> <p> size_t size<b>;</b></p> <p> <b>if</b> <b>(</b>fd <b><</b> 0 <b>||</b> <b>!</b>string<b>)</b></p> <p> <b>return</b> <b>-</b>1<b>;</b></p> <p> // Get the size of the string</p> <p> size <b>=</b> strlen<b>(</b>string<b>);</b></p> <p> // While there are bytes left to send</p> <p> <b>while</b> <b>(</b>size <b>></b> 0<b>)</b> <b>{</b></p> <p> // Try to write size bytes </p> <p> ssize_t sent <b>=</b> write<b>(</b>fd<b>,</b> string<b>,</b> size<b>);</b></p> <p> // Check for error</p> <p> <b>if</b> <b>(</b>sent <b><</b> 0<b>)</b> <b>{</b></p> <p> int err <b>=</b> errno<b>;</b></p> <p> fprintf<b>(</b>stderr<b>,</b> "write error %d - %s\n"<b>,</b></p> <p> err<b>,</b> strerror<b>(</b>err<b>));</b></p> <p> <b>return</b> <b>-</b>2<b>;</b></p> <p> <b>}</b></p> <p> // Update size & buffer</p> <p> size <b>-=</b> sent<b>;</b></p> <p> string <b>+=</b> sent<b>;</b></p> <p> <b>}</b></p> <p> <b>return</b> 0<b>;</b></p> <p> <b>}</b> </p> <p>Read_buffer function is created to initialized index and attempt to read (size - index) bytes into buffer at offset index. Read from a file descriptor into a buffer of size bytes. </p> <p> </p> <p>ssize_t read_buffer<b>(</b>int fd<b>,</b> char <b>*</b>buffer<b>,</b> size_t size<b>)</b></p> <p> <b>{</b> </p> <p> // The index into the buffer</p> <p> ssize_t index<b>;</b></p> <p> <b>if</b> <b>(</b>fd <b><</b> 0 <b>||</b> <b>!</b>buffer <b>||</b> size <b><</b> 0<b>)</b></p> <p> <b>return</b> <b>-</b>1<b>;</b></p> <p> // Initialize the index</p> <p> index <b>=</b> 0<b>;</b></p> <p> // While the index into the buffer is less</p> <p> // than its size</p> <p> <b>while</b> <b>(</b>index <b><</b> size<b>)</b> <b>{</b></p> <p> // Attempt to read (size - index) bytes</p> <p> // into buffer at offset index</p> <p> ssize_t bytes_read <b>=</b> read<b>(</b>fd<b>,</b> buffer <b>+</b> index<b>,</b></p> <p> size <b>-</b> index<b>);</b></p> <p> // If nothing left then break out of the loop</p> <p> <b>if</b> <b>(</b>bytes_read <b>==</b> 0<b>)</b></p> <p> <b>break</b><b>;</b></p> <p> // Has an error occurred?</p> <p> <b>if</b> <b>(</b>bytes_read <b><</b> 0<b>)</b> <b>{</b></p> <p> int err <b>=</b> errno<b>;</b></p> <p> fprintf<b>(</b>stderr<b>,</b> "read blew %d - %s\n"<b>,</b></p> <p> err<b>,</b> strerror<b>(</b>err<b>));</b></p> <p> <b>return</b> <b>-</b>2<b>;</b></p> <p> <b>}</b></p> <p> // Add the bytes read to update the index</p> <p> index <b>+=</b> bytes_read<b>;</b></p> <p> <b>}</b></p> <p> <b>return</b> index<b>;</b></p> <p> <b>}</b> </p> <p>main() function is defined that defines files descriptor for first and second pipe and creating them. A child process is forked to run different pipelines.</p> <p>//The startup function </p> <p>int main<b>(</b>int argc<b>,</b> char <b>**</b>argv<b>)</b></p> <p> <b>{</b> </p> <p> </div>
<h2>Step-4</h2>
<div class="answer"> // File descriptors for the 1st pipe</p> <p> int fd1<b>[</b>2<b>];</b></p> <p> // File descriptors for the 2nd pipe</p> <p> int fd2<b>[</b>2<b>];</b></p> <p> // A buffer to store data read from or written to</p> <p> // a file descriptor</p> <p> char buffer<b>[</b>BUFFER_SIZE<b>];</b></p> <p> // Check if we were invoked with strings to reverse</p> <p> <b>if</b> <b>(</b>argc <b>==</b> 1<b>)</b> <b>{</b></p> <p> fprintf<b>(</b>stderr<b>,</b> "%s [strings to reverse]\n"<b>,</b></p> <p> <b>*</b>argv<b>);</b></p> <p> <b>return</b> 1<b>;</b></p> <p> <b>}</b></p> <p> // Create the 1st pipe</p> <p> <b>if</b> <b>(</b>pipe<b>(</b>fd1<b>)</b> <b><</b> 0<b>)</b> <b>{</b></p> <p> fprintf<b>(</b>stderr<b>,</b> "pipe blew %d\n"<b>,</b> errno<b>);</b></p> <p> <b>return</b> 2<b>;</b></p> <p> <b>}</b></p> <p> // Create the 2nd pipe</p> <p> <b>if</b> <b>(</b>pipe<b>(</b>fd2<b>)</b> <b><</b> 0<b>)</b> <b>{</b></p> <p> fprintf<b>(</b>stderr<b>,</b> "pipe blew %d\n"<b>,</b> errno<b>);</b></p> <p> // Close the file descriptors of the 1st pipe</p> <p> close<b>(</b>fd1<b>[</b>WRITE_END<b>]);</b></p> <p> close<b>(</b>fd1<b>[</b>READ_END<b>]);</b></p> <p> <b>return</b> 2<b>;</b></p> <p> <b>}</b></p> <p> // Fork a child process</p> <p> pid_t pid <b>=</b> fork<b>();</b></p> <p> // Check if are we in the parent process?</p> <p> <b>if</b> <b>(</b>pid <b>></b> 0<b>)</b> <b>{</b></p> <p> int index<b>,</b> bytes_read<b>;</b></p> <p> // Close the reading end of the 1st pipe</p> <p> close<b>(</b>fd1<b>[</b>READ_END<b>]);</b></p> <p> // Close the writing end of the 2nd pipe</p> <p> close<b>(</b>fd2<b>[</b>WRITE_END<b>]);</b></p> <p> // For all the arguments the program</p> <p> // was invoked with</p> <p> <b>for</b> <b>(</b>index <b>=</b> 1<b>;</b> index <b><</b> argc<b>;</b> index<b>++)</b></p> <p> // Write current argument to the writing</p> <p> // end of the 1st pipe</p> <p> <b>if</b> <b>(</b>write_string<b>(</b>fd1<b>[</b>WRITE_END<b>],</b></p> <p> argv<b>[</b>index<b>])</b> <b><</b> 0<b>)</b></p> <p> <b>break</b><b>;</b></p> <p> // Close the writing end of the 1st pipe</p> <p> close<b>(</b>fd1<b>[</b>WRITE_END<b>]);</b></p> <p> // Loop while data can be read from the</p> <p> // reading end of the 2nd pipe</p> <p> <b>while</b> <b>((</b>bytes_read <b>=</b> read<b>(</b>fd2<b>[</b>READ_END<b>],</b></p> <p> buffer<b>,</b></p> <p> <b>sizeof</b><b>(</b>buffer<b>)</b> <b>-</b> 1<b>))</b></p> <p> <b>></b> 0<b>)</b> <b>{</b></p> <p> // Null terminate the string read</p> <p> buffer<b>[</b>bytes_read<b>]</b> <b>=</b> '\0'<b>;</b></p> <p> // Output the string</p> <p> fputs<b>(</b>buffer<b>,</b> stdout<b>);</b></p> <p> <b>}</b></p> <p> // Output a newline</p> <p> fputc<b>(</b>'\n'<b>,</b> stdout<b>);</b></p> <p> // Close the reading end of the 2nd pipe</p> <p> close<b>(</b>fd2<b>[</b>READ_END<b>]);</b></p> <p> // Wait for the child to exit</p> <p> wait<b>(</b><b>NULL</b><b>);</b></p> <p> <b>}</b></p> <p> // Is it the child process?</p> <p> <b>else</b> <b>if</b> <b>(</b>pid <b>==</b> 0<b>)</b> <b>{</b></p> <p> int bytes_read<b>,</b> index<b>;</b></p> <p> // Close the writing end of the 1st pipe</p> <p> close<b>(</b>fd1<b>[</b>WRITE_END<b>]);</b></p> <p> // Close the reading end of the 2nd pipe</p> <p> close<b>(</b>fd2<b>[</b>READ_END<b>]);</b></p> <p> </p> <p>Read data into buffer from the reading end of the 1st pipe<b>.</b> Assume that no more than the buffer's (size - 1) bytes are written. </p> <p> </p> <p> bytes_read <b>=</b> read_buffer<b>(</b>fd1<b>[</b>READ_END<b>],</b></p> <p> buffer<b>,</b></p> <p> <b>sizeof</b><b>(</b>buffer<b>)</b> <b>-</b> 1<b>);</b></p> <p> // Close the reading end of the 1st pipe</p> <p> close<b>(</b>fd1<b>[</b>READ_END<b>]);</b></p> <p> // Cycle from the 1st byte of the buffer to</p> <p> // the middle of it</p> <p> <b>for</b> <b>(</b>index <b>=</b> 0<b>;</b> index <b><</b> bytes_read <b>/</b> 2<b>;</b> index<b>++)</b></p> <p> <b>{</b></p> <p> // Interchange the byte at index with</p> <p> // the byte at (bytes_read - index - 1)</p> <p> char tmp <b>=</b> buffer<b>[</b>index<b>];</b></p> <p> buffer<b>[</b>index<b>]</b> <b>=</b> buffer<b>[</b>bytes_read</p> <p> <b>-</b> index <b>-</b> 1<b>];</b></p> <p> buffer<b>[</b>bytes_read <b>-</b> index <b>-</b> 1<b>]</b> <b>=</b> tmp<b>;</b></p> <p> <b>}</b></p> <p> // Null terminate the buffer</p> <p> buffer<b>[</b>bytes_read<b>]</b> <b>=</b> '\0'<b>;</b></p> <p> // Write the buffer to the writing end</p> <p> // of the 2nd pipe</p> <p> write_string<b>(</b>fd2<b>[</b>WRITE_END<b>],</b> buffer<b>);</b></p> <p> // Close the writing end of the 2nd pipe</p> <p> close<b>(</b>fd2<b>[</b>WRITE_END<b>]);</b></p> <p> <b>}</b></p> <p> // Did the fork system call malfunction?</p> <p> <b>else</b> <b>{</b></p> <p> </div>
<h2>Step-5</h2>
<div class="answer"> fprintf<b>(</b>stderr<b>,</b> "fork blew %d\n"<b>,</b> errno<b>);</b></p> <p> // Close the file descriptors of both the pipes</p> <p> close<b>(</b>fd1<b>[</b>WRITE_END<b>]);</b></p> <p> close<b>(</b>fd1<b>[</b>READ_END<b>]);</b></p> <p> close<b>(</b>fd2<b>[</b>WRITE_END<b>]);</b></p> <p> close<b>(</b>fd2<b>[</b>READ_END<b>]);</b></p> <p> <b>return</b> 3<b>;</b></p> <p> <b>}</b></p> <p> <b>return</b> 0<b>;</b></p> <p> <b>}</b> </p> </div>
<h2>Step-6</h2>
<div class="answer"> <p> <b>Sample Output:</b> </p> <p>[abc@localhost 3]$ ./3-26PP abcdefghijklmnopqrstuvwxyz</p> <p>zyxwvutsrqponmlkjihgfedcba</p></div>
